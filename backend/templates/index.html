<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Meeting Summarizer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    /* Markdown styling for action items */
    #actionItems strong {
      font-weight: 700;
      color: #1f2937;
    }
    #actionItems em {
      font-style: italic;
      color: #374151;
    }
    /* Bright scrollbar */
    *::-webkit-scrollbar {
      width: 8px;
    }
    *::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }
    *::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 4px;
    }
    *::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    * {
      scrollbar-width: thin;
      scrollbar-color: #d1d5db #f1f5f9;
    }
    /* Subtle background pattern */
    body {
      background: linear-gradient(to bottom right, #ffffff, #f8fafc);
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23e2e8f0' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30v4h4v2h-4v4h-2v-4h-4v-2h4v-4h2zm-12 28v4h2v-4h4v-2h-4v-4h-2v4h-4v2h4zm-12-12v2h4v4h2v-4h4v-2h-4v-4h-2v4h-4z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }
  </style>
</head>
<body class="h-full flex flex-col p-4 sm:p-6">
  <!-- Header -->
  <header class="w-full max-w-7xl mx-auto mb-6">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">AI Meeting Summarizer</h1>
        <p class="text-sm text-gray-500 mt-1">Effortlessly distill meeting transcripts into concise insights.</p>
      </div>
      <div class="text-sm text-gray-500">Powered by xAI</div>
    </div>
  </header>

  <!-- Main Container -->
  <main class="w-full max-w-7xl mx-auto h-[calc(100vh-8rem)] flex bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
    <!-- Left Section: Transcript Input -->
    <div id="input-section" class="flex-1 p-6 sm:p-8 flex flex-col space-y-6 overflow-y-auto">
      <div class="space-y-3">
        <label for="transcript" class="block text-sm font-medium text-gray-700">Meeting Transcript</label>
        <textarea
          id="transcript"
          rows="12"
          class="w-full bg-gray-50 text-gray-900 border border-gray-300 rounded-lg p-4 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-150 placeholder-gray-400 text-base"
          placeholder="Paste or type your meeting transcript here..."
        ></textarea>
      </div>
      <div class="flex items-center gap-4">
        <button
          id="summarizeBtn"
          class="bg-blue-600 text-white px-6 py-2.5 rounded-lg font-medium shadow-sm hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-150 text-base"
        >
          Summarize
        </button>
        <button
          id="clearBtn"
          class="bg-gray-200 text-gray-700 px-6 py-2.5 rounded-lg font-medium hover:bg-gray-300 transition-all duration-150 text-base"
        >
          Clear
        </button>
        <div id="loading" class="text-sm text-gray-500 hidden flex items-center gap-2">
          <svg class="animate-spin h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
          </svg>
          Processing...
        </div>
      </div>
      <!-- Status Bar -->
      <div class="text-sm text-gray-500 flex justify-between items-center">
        <span>Character count: <span id="charCount">0</span></span>
        <span>Last summarized: <span id="lastSummarized">Never</span></span>
      </div>
    </div>

    <!-- Right Section: Summary Panel (Hidden by Default) -->
    <div
      id="result"
      class="w-0 lg:w-96 bg-white border-l border-gray-200 p-0 lg:p-6 flex flex-col space-y-6 overflow-y-auto transition-all duration-300 hidden"
    >
      <div class="space-y-3">
        <h2 class="text-lg font-medium text-gray-900">Summary</h2>
        <div id="summaryText" class="bg-gray-50 p-4 rounded-lg text-gray-700 text-base"></div>
      </div>
      <div class="space-y-3">
        <h2 class="text-lg font-medium text-gray-900">Action Items</h2>
        <ul id="actionItems" class="space-y-3"></ul>
      </div>
      <button
        id="exportBtn"
        class="bg-blue-600 text-white px-6 py-2.5 rounded-lg font-medium shadow-sm hover:bg-blue-700 transition-all duration-150 text-base"
      >
        Export Summary
      </button>
    </div>
  </main>

  <!-- JavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const summarizeBtn = document.getElementById("summarizeBtn");
      const clearBtn = document.getElementById("clearBtn");
      const exportBtn = document.getElementById("exportBtn");
      const loading = document.getElementById("loading");
      const resultDiv = document.getElementById("result");
      const summaryText = document.getElementById("summaryText");
      const actionItemsList = document.getElementById("actionItems");
      const transcript = document.getElementById("transcript");
      const charCount = document.getElementById("charCount");
      const lastSummarized = document.getElementById("lastSummarized");

      if (!summarizeBtn || !clearBtn || !exportBtn || !loading || !resultDiv || !summaryText || !actionItemsList || !transcript || !charCount || !lastSummarized) {
        console.error("One or more DOM elements not found.");
        alert("‚ö†Ô∏è Application error: Required elements not found.");
        return;
      }

      // Character count update
      transcript.addEventListener("input", () => {
        charCount.textContent = transcript.value.length;
      });

      // Clear button
      clearBtn.addEventListener("click", () => {
        transcript.value = "";
        charCount.textContent = "0";
        resultDiv.classList.add("hidden");
        resultDiv.classList.remove("w-80", "lg:w-96", "p-6");
        resultDiv.classList.add("w-0", "p-0");
      });

      // Export button (placeholder)
      exportBtn.addEventListener("click", () => {
        alert("Export functionality coming soon!");
      });

      // Summarize button
      summarizeBtn.addEventListener("click", async () => {
        const transcriptValue = transcript.value.trim();
        if (!transcriptValue) return alert("Please paste a transcript.");

        loading.classList.remove("hidden");
        resultDiv.classList.add("hidden");
        resultDiv.classList.remove("w-0", "p-0");
        resultDiv.classList.add("w-80", "lg:w-96", "p-6");

        try {
          const response = await fetch("http://127.0.0.1:5000/summarize", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ transcript: transcriptValue }),
          });

          if (!response.ok) throw new Error("Server error");

          const data = await response.json();
          summaryText.textContent = data.summary || "No summary returned.";
          actionItemsList.innerHTML = "";
          // Parse action items to extract Task, POC, and Deadline
          (data.action_items || []).forEach((item) => {
            const li = document.createElement("li");
            const parsed = marked.parseInline(item);
            const match = parsed.match(/Task: (.*?)(?:<br>|\s*Point of Contact \(POC\): (.*?)(?:<br>|\s*Deadline: (.*))?)?/i);
            if (match) {
              const task = match[1] || "No task specified";
              const poc = match[2] || "Unassigned";
              const deadline = match[3] || "No deadline";
              li.innerHTML = `
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 shadow-sm hover:bg-gray-100 transition-all duration-150 space-y-2">
                  <div class="flex items-start gap-2">
                    <span class="text-gray-500 text-sm">üìã</span>
                    <span class="font-medium text-gray-900 text-base">${task}</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-gray-500 text-sm">üë§</span>
                    <span class="text-blue-600 text-base">${poc}</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="text-gray-500 text-sm">üìÖ</span>
                    <span class="${deadline.includes('Friday') || deadline.includes('End of Day') ? 'text-red-600' : 'text-gray-700'} text-base">${deadline}</span>
                  </div>
                </div>
              `;
            } else {
              li.innerHTML = `<div class="bg-gray-50 border border-gray-200 rounded-lg p-4 shadow-sm hover:bg-gray-100 transition-all duration-150">${parsed}</div>`;
            }
            actionItemsList.appendChild(li);
          });

          resultDiv.classList.remove("hidden");
          lastSummarized.textContent = new Date().toLocaleTimeString();
        } catch (err) {
          alert("‚ö†Ô∏è Something went wrong: " + err.message);
          console.error(err);
        } finally {
          loading.classList.add("hidden");
        }
      });
    });
  </script>
</body>
</html>